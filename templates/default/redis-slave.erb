#!/bin/sh
# chkconfig: 345 99 01
# description: redis-slave startup script

start() {
        echo -n "Starting redis-slave"
        cd <%= node.override['redisio']['install_dir'] %>;<%= node.override['redisio']['install_dir'] %>/src/redis-server --port <%= @slaveport %> --cluster-enabled yes --cluster-config-file <%= node.override['redisio']['install_dir'] %>/node-<%= @slaveport %>.conf --cluster-node-timeout 10000 --appendonly yes --appendfilename appendonly-<%= @slaveport %>.aof --dbfilename dump-<%= @slaveport %>.rdb --logfile <%= node.override['redisio']['install_dir'] %>/<%= @slaveport %>.log --daemonize yes --protected-mode no
}

stop() {
       echo -n "Stopping redis-slave"
       kill -9 $(ps -ax|grep redis|ps axf | grep 6380 | grep -v grep | awk '{print $1}')
}

case "$1" in
  start)
        start
        ;;
  stop)
        stop
        ;;
  restart)
        stop
        start
        ;;
  *)
        echo $"Usage: $0 {start|stop|restart}"
        exit 1
esac
exit 0
