#!/bin/sh
# chkconfig: 345 99 01
# description: redis-master startup script

start() {
        echo -n "Starting redis-master"
        cd <%= node.override['redisio']['install_dir'] %>;<%= node.override['redisio']['install_dir'] %>/src/redis-server --port <%= @masterport %> --cluster-enabled yes --cluster-config-file <%= node.override['redisio']['install_dir'] %>/node-<%= @masterport %>.conf --cluster-node-timeout 10000 --appendonly yes --appendfilename appendonly-<%= @masterport %>.aof --dbfilename dump-<%= @masterport %>.rdb --logfile <%= node.override['redisio']['install_dir'] %>/<%= @masterport %>.log --daemonize yes --protected-mode no
}

stop() {
       echo -n "Stopping redis-master"
       kill -9 $(ps -ax|grep redis|ps axf | grep 6379 | grep -v grep | awk '{print $1}')
}

case "$1" in
  start)
        start
        ;;
  stop)
        stop
        ;;
  restart)
        stop
        start
        ;;
  *)
        echo $"Usage: $0 {start|stop|restart}"
        exit 1
esac
exit 0
